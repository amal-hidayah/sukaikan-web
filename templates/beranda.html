{% extends "base.html" %}

{% block title %}Beranda - SUKAIKAN{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <div class="hero-content">
            <h1 class="hero-title">
                Solusi Belanja Ikan Cerdas <br>
                <span class="text-accent">Ikan Segar, Dipandu Resep Pintar</span>
            </h1>
            <p class="hero-subtitle">
                Tidak perlu lagi bingung memilih ikan segar atau cara memasaknya agar tidak amis.
                Pesan via sistem Batching kami untuk kesegaran maksimal, lengkap dengan rekomendasi resep masakan
                instan.
            </p>

            <div class="flex flex-col gap-4">
                <div class="flex gap-4 hero-buttons">
                    <a href="{{ url_for('katalog') }}" class="btn btn-primary">
                        <i class="fa-solid fa-basket-shopping"></i> Eksplorasi Pasar Ikan
                    </a>
                    <a href="#cara-kerja" class="btn btn-outline">
                        <i class="fa-solid fa-circle-info"></i> Cara Kerja Kami
                    </a>
                </div>

                <div class="alert alert-info flex items-center gap-2"
                    style="display: inline-flex; width: fit-content; margin-top: 1rem;">
                    <i class="fa-regular fa-clock"></i>
                    <span class="text-sm">
                        <strong>Pre-Order Batch:</strong> {{ batch.nama }} â€¢
                        <strong>Berangkat:</strong> <span id="countdown-timer">{{ batch.countdown }}</span>
                    </span>
                </div>
            </div>


        </div>


    </div>
</section>

<!-- Features / How it Works -->
<section id="cara-kerja" class="section bg-white">
    <div class="container">
        <div class="text-center" style="margin-bottom: 3rem;">
            <h2 class="text-primary">Cara Kerja Marketplace</h2>
            <p>Teknologi yang mendekatkan laut ke dapurmu</p>
        </div>

        <div class="grid grid-3">
            <div class="card text-center" style="padding: 2rem;">
                <div style="font-size: 3rem; color: var(--accent-coral); margin-bottom: 1rem;">
                    <i class="fa-solid fa-mobile-screen-button"></i>
                </div>
                <h4>1. Kamu Pesan Online</h4>
                <p class="text-sm">Pilih ikan yang sedang musim di aplikasi kami. Pesananmu akan diteruskan ke ketua
                    kelompok nelayan.
                </p>
            </div>

            <div class="card text-center" style="padding: 2rem;">
                <div style="font-size: 3rem; color: var(--primary-blue); margin-bottom: 1rem;">
                    <i class="fa-solid fa-ship"></i>
                </div>
                <h4>2. Mitra Nelayan Melaut</h4>
                <p class="text-sm">Nelayan berangkat melaut khusus untuk memenuhi pesanan yang masuk. Tidak ada ikan
                    sisa stok.</p>
            </div>

            <div class="card text-center" style="padding: 2rem;">
                <div style="font-size: 3rem; color: var(--success); margin-bottom: 1rem;">
                    <i class="fa-solid fa-truck-fast"></i>
                </div>
                <h4>3. Langsung Diantar</h4>
                <p class="text-sm">Tiba di dermaga, ikan langsung dipacking dan dikirim kurir kilat ke alamatmu.</p>
            </div>
        </div>
    </div>
</section>

<!-- Featured Products (Seasonal) -->
<section class="section">
    <div class="container">
        <div class="flex justify-between items-center" style="margin-bottom: 2rem;">
            <div>
                <h2>Sedang Musim</h2>
                <p>Tangkapan terbaik minggu ini</p>
            </div>
            <a href="{{ url_for('katalog') }}" class="btn btn-secondary btn-slim">
                Lihat Semua <i class="fa-solid fa-arrow-right"></i>
            </a>
        </div>

        <div class="grid grid-4">
            {% for p in produk_musim %}
            <div class="card product-card">
                <div class="card-img-wrapper">
                    <div class="card-badges">
                        <span class="tag tag-hot">{{ p.label_musim }}</span>
                    </div>
                    {% if p.image_path %}
                    <img src="{{ url_for('uploaded_file', filename=p.image_path) }}" alt="{{ p.nama }}"
                        class="card-img">
                    {% else %}
                    <div class="card-placeholder">
                        <i class="fa-solid fa-fish"></i>
                    </div>
                    {% endif %}
                </div>

                <div class="card-body">
                    <h3 class="card-title">{{ p.nama }}</h3>
                    <p class="card-meta">{{ p.ukuran }}</p>
                    <div class="card-price">
                        Rp {{ "{:,.0f}".format(p.harga_per_kg) }} <span>/kg</span>
                    </div>

                    <form action="{{ url_for('tambah_ke_keranjang') }}" method="post">
                        <input type="hidden" name="product_id" value="{{ p.id }}">
                        <input type="hidden" name="next" value="{{ url_for('beranda') }}">

                        <div class="card-actions">
                            <div class="qty-stepper">
                                <button type="button" class="qty-btn" onclick="updateQty(this, -1)">
                                    <i class="fa-solid fa-minus"></i>
                                </button>
                                <input type="number" name="qty" value="1" min="1" max="100" readonly class="qty-input">
                                <button type="button" class="qty-btn" onclick="updateQty(this, 1)">
                                    <i class="fa-solid fa-plus"></i>
                                </button>
                            </div>

                            <button type="submit" class="btn-add">
                                <i class="fa-solid fa-cart-plus"></i> Tambah
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="col-span-full text-center py-10">
                <p>Belum ada produk musiman saat ini.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Countdown Timer Script
        // Supports HH:MM:SS or DD:HH:MM:SS
        const timerEl = document.getElementById('countdown-timer');
        if (!timerEl) return;

        let timeStr = timerEl.innerText.trim();
        let parts = timeStr.split(':');

        let days = 0, hours = 0, minutes = 0, seconds = 0;

        if (parts.length === 4) {
            days = parseInt(parts[0], 10);
            hours = parseInt(parts[1], 10);
            minutes = parseInt(parts[2], 10);
            seconds = parseInt(parts[3], 10);
        } else if (parts.length === 3) {
            hours = parseInt(parts[0], 10);
            minutes = parseInt(parts[1], 10);
            seconds = parseInt(parts[2], 10);
        } else {
            return; // invalid format
        }

        let totalSeconds = days * 86400 + hours * 3600 + minutes * 60 + seconds;

        const interval = setInterval(function () {
            if (totalSeconds <= 0) {
                clearInterval(interval);
                timerEl.innerText = "PO Ditutup";
                return;
            }

            totalSeconds--;

            let d = Math.floor(totalSeconds / 86400);
            let h = Math.floor((totalSeconds % 86400) / 3600);
            let m = Math.floor((totalSeconds % 3600) / 60);
            let s = totalSeconds % 60;

            // Pad with leading zeros for HH:MM:SS
            let hStr = h < 10 ? '0' + h : h;
            let mStr = m < 10 ? '0' + m : m;
            let sStr = s < 10 ? '0' + s : s;

            if (d > 0) {
                timerEl.innerText = `${d} hari ${hStr} jam ${mStr} menit ${sStr} detik`;
            } else {
                timerEl.innerText = `${hStr} jam ${mStr} menit ${sStr} detik`;
            }
        }, 1000);
    });

    function updateQty(btn, change) {
        const input = btn.parentElement.querySelector('input[name="qty"]');
        let val = parseInt(input.value);
        val += change;
        if (val < 1) val = 1;
        input.value = val;
    }
</script>
{% endblock %}